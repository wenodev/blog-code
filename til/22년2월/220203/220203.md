# 2022/02/03 TIL

## JPA 프로그밍 기본편 : 값 타입과 불변 객체

> 임베디드 타입 같은 값 타입을 여러 엔티티에서 공유하면 side effect가 발생할 수 있다.

두 개의 엔티티에서 동일한 값 타입을 참조하게 되면, 하나의 엔티티에 해당하는 값 객체 값을 변경하면 나머지 하나의 객체에 영향을 미치게 된다.

```java
Address address = new Address("city", "address", "1000");

Member merber1 = new Memeber("name1", address);
Member merber2 = new Memeber("name2", address);

member1.getAddress().setCity("city1"); // member2의 city값도 같이 변경된다.
```

그 이유는 당연하게도 자바에서 객체는 참조값을 복하기 때문이다.

```java
Address a1 = new Address();
Address a2 = a1; // 참조값 전달
```

따라서 값 객체의 경우에는 불변객체(immutable object)로 설계해야한다.  
그렇게하려면 생성자로만 값을 설정하고 수정자를 만들지 않으면 된다.  
ex) String, Ingeger..  
값을 변경할고 싶을때는 새로은 인스턴스를 만들어서 저장하면 된다.

```java
Address address = new Address("city", "address", "1000");

Member merber1 = new Memeber("name1", address);
Member merber2 = new Memeber("name2", address);

member1.setAddress( new Address("city1", "address", "1000")); // m1만 변경된다.
```
